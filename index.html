<!DOCTYPE html>
<html>

<head>
  <title>It Literally Plays All the Ongaku Sh≈çjo Music</title>
  <meta charset='utf-8'/>
  <script src="data.js"></script>
    <script>
// this dumb bit of "encryption" is not meant to keep a determined individual
// from getting the links stored here, since it is fairly simple to crack
// however, it is enough to keep any basic web crawler from picking them up
const amq_scramble = {};

amq_scramble.hosts = {
  "catbox": "https://files.catbox.moe",
  "track9": "https://track9.mixtape.moe",
};
amq_scramble.decode_link_obj = function(link_obj, password) {
  let link = amq_scramble.hosts[link_obj.host] + '/';
  for(let i = 0; i < link_obj.code.length; i++) {
    link += String.fromCharCode(link_obj.code[i] ^ password.charCodeAt(i % password.length)); //fun
  };
  return link + '.' + link_obj.ext;
};
amq_scramble.parse_link_string = function(link_string) {
  let semi_split = link_string.split(';');
  return {
    host: semi_split[0],
    code: semi_split[1].split(',').map(x => parseInt(x)),
    ext:  semi_split[2],
  };
};
amq_scramble.decode = function(link_string, password) {
  return amq_scramble.decode_link_obj(amq_scramble.parse_link_string(link_string), password);
};

let cur_song = 0;
let cur_group = 'Ongaku Shoujo';
let quality = 'mp3';
let player = undefined;
let desc = undefined;
let password = '';

const play_song = function(index) {
  player.src = amq_scramble.decode(data[cur_group][cur_song][quality], password);
  desc.innerHTML = data[cur_group][cur_song].desc;
};

const start = function() {
  player = document.getElementById('player');
  desc = document.getElementById('desc');
  password = document.getElementById('password_input').value;
  document.getElementById('password_input').remove();
  document.getElementById('password_lable').remove();
  document.getElementById('password_button').remove();
  play_song(cur_song);
  player.addEventListener('ended', function() {
    cur_song = (cur_song + 1) % data[cur_group].length;
    play_song(cur_song);
  });
};
    </script>
</head>

<body>
  <video controls id='player' autoplay='true' width='640'></video>
  <p id='desc'></p>
  <p id='password_lable'>Password:</p><input id='password_input' type="text" name="password_name">
  <button id='password_button' onclick="start()">Submit</button>
</body>

</html>
